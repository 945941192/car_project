		
    {% extends 'base/base.html' %}
    {% block title %}上传主机check日志{% endblock %}
        {% block content %}

			<div class="am-u-md-41" id="contents" style="overflow:auto;">
<br>
<br>
<br>
<div style="border-left-width: 32px;margin-left: 50px;">
    <form id="query_host" enctype="multipart/form-data" action="{% url 'aliyun:query_host' %}"  method="post">

        <h4 style="display: inline-block;">云类别&nbsp;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h4>
        <select class="form-control" id="cloud_id" name="cloud_type"  style="width:15%;display:inline-block" disabled="disabled">
                <option value="#">专有云</option>
        </select>

        <h2 style="display: inline-block">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h2>

        <h4 style="display: inline-block;">版本&nbsp;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h4>
        <select class="form-control" id="cloud_version_id" name="cloud_version_id"  style="width:15%;display:inline-block">
            <option value="all">All ...</option>
            {% for obj in version_set  %}
                <option value="{{ obj.version_id }}">{{ obj.version_type }}</option>
            {% endfor  %}
        </select>

        <h2 style="display: inline-block">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h2>

        <h4 style="display: inline-block;">项目名称&nbsp;:&nbsp;&nbsp;&nbsp;&nbsp;</h4>
        <select class="project_list" id="project_id"  name="project_id" class="form-control" multiple="multiple" style="width: 20%" data-placeholder="All ..." ></select>

<br>
<br>

        <h4 style="display: inline-block;">检测项&nbsp;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h4>
        <select class="form-control" id="check_item_id" name="check_item_id"  style="width:15%;display:inline-block">
            <option value="all">All ...</option>
            {% for obj in check_item_set  %}
                <option value="{{ obj.id }}">{{ obj.check_item_name_CN }}</option>
            {% endfor  %}
        </select>

        <h2 style="display: inline-block">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h2>

        <h4 style="display: inline-block;">日期&nbsp;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h4>
        <input type="text" class="form-control" id="startDate" name="date_range" style="width:20%;display:inline-block;">

        <h2 style="display: inline-block">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h2>

        <button  type="button" style="display:inline-block"  class="btn btn-success"  onclick="query_host()">Query</button>      

</form>
        <br>
        <div id="div1" style=" border-bottom: 1px solid red;"></div>
        <h4 style="display: inline-block;">查询主机列表&nbsp;:</h4>

                        <table id="example" class="display" cellspacing="0" width="100%">
                            <thead>                         
                            <tr>                            
                                <th  style="text-align:center;">主机名称</th>                
                                <th  style="text-align:center;">最新监测日期</th>               
                                <th  style="text-align:center;">健康值  </th>            
                            </tr>                           
                            </thead>                                                                  
                            <tbody>                         
                                {% for info in host_set %}
                                <tr>                            
                                    <td style="width:20%;text-align:center;"><a href="{% url 'aliyun:host' %}?version={{version}}&&project_name={{project_name}}&&host_id={{info.host_id}}&&host_name={{info.host_address}}">{{ info.host_address }}</a></td>
                                    <td class="tool_instruction"  style="width:20%;text-align:center">{{ info.host_check_date_form }}</td> 
                                    <td class="tool_instruction"  style="width:20%;text-align:center">
                                        <div class="progress progress-striped" style="margin-bottom: 0px;">
                                            {% if info.newest_check_health_num_asy >= 80 %}
                                                <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: {{ info.newest_check_health_num_asy }}%;">
                                                    <span>{{ info.newest_check_health_num_asy }}</span>
                                                </div>
                                                {% elif info.newest_check_health_num_asy < 80 and info.newest_check_health_num_asy >= 60 %}
                                                <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: {{ info.newest_check_health_num_asy }}%;">
                                                    <span>{{ info.newest_check_health_num_asy }}</span>
                                                </div>
                                                {% elif info.newest_check_health_num_asy <= 60  %}
                                                <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: {{ info.newest_check_health_num_asy }}%;">
                                                    <span>{{ info.newest_check_health_num_asy }}</span>
                                                </div>
                                            {% endif %}
                                        </div> 
                                    </td> 
                                </tr>                           
                                {% endfor %}
                            </tbody>                        
                        </table>     



</div>
<br>
			</div>


            {% endblock %}


		



        {% block extrajs %}
		<script type="text/javascript">
            //submit form data
            function query_host(){
                $("#query_host").submit()
            };


            //select2 异步请求获取项目列表
            function select2_fun(cloud_version_id){
                $(".project_list").select2({
                    ajax: {
                        url: "{% url 'aliyun:project_list' %}?&cloud_version_id="+cloud_version_id,
                        cache: true,
                    }
                });

            }
        
        $('#startDate').daterangepicker({
          // singleDatePicker: true,
          startDate: moment().subtract(6, 'days')
        });

            $(document).ready(function() {
                //初始化云类型版本类型为专有云
                //$("#cloud_type_id").val({{ pre_cloud_type_id  }})
                //select 选择云类型时发送请求获取信息
                //$("#cloud_type_id").val({{ cloud_type_id }})
                //$("#cloud_version_id").val({{ cloud_version_id }})
                //var cloud_type_id = $("#cloud_type_id").val()
                var cloud_version_id = $("#cloud_version_id").val()
                select2_fun(cloud_version_id)
                //$("#cloud_type_id").change(function(){
                //    var cloud_type_id = $("#cloud_type_id").val()
                //    var cloud_version_id = $("#cloud_version_id").val()
                //    var url = "{% url 'aliyun:upload_host_check_log'  %}?cloud_type_id="+cloud_type_id
                //    window.location.href = url;
                 //   select2_fun(cloud_version_id)
                //});
                $("#cloud_version_id").change(function(){
                    var cloud_type_id = $("#cloud_type_id").val()
                    var cloud_version_id = $("#cloud_version_id").val()
                    var url = "{% url 'aliyun:upload_host_check_log' %}?cloud_type_id="+cloud_type_id+'&cloud_version_id='+cloud_version_id
                    //清空 项目下拉菜单
                    $("#project_id").val('')
//                    window.location.href = url;
                    select2_fun(cloud_version_id)
                });

            });
            
            $(document).ready(function() {
                $('#example').DataTable( {
                });

            });

        </script>
	
        {% endblock %}	

