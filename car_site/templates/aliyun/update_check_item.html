		
    {% extends 'base2/base.html' %}
        {% block title %}检测项{% endblock %}
        {% block content %}
    {% load tags %}
        <div class="page-title">
              <div class="title_left">
              </div>
        </div>

        <div class="clearfix"></div>

        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                    <div class="x_title">
                        <h3>Check Item <small>提供检查项<span style="color:red"> 增加</span>、<span style="color:blue"> 编辑</span>、<span style="color:black">展示 </span>功能</small></h3>
                        <ul class="nav navbar-right panel_toolbox">
                            <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                                <ul class="dropdown-menu" role="menu">
                                </ul>
                            </li>
                            <li><a class="close-link"><i class="fa fa-close"></i></a>
                            </li>
                        </ul>
                    <div class="clearfix"></div>
                    </div>
                    <div class="x_content">
                        <p class="text-muted font-13 m-b-30"></p>


                <button class="btn btn-warning" data-toggle="modal" data-target="#myModal" style=" border-radius:20px;">
                     新增检测项   
                </button>   

                <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-dialog"> 
                        <div class="modal-content" style="width: 802px;">
                            <div class="modal-header">      
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                 &times;    
                                </button>      
                                <h4 class="modal-title" id="myModalLabel">
                                    添加检测项详情
                                </h4>
                            </div>
                            <div class="modal-body">        

                            <table id="example1" class="table table-bordered table-striped" aria-describedby="example1_info">
                                <tbody>
                                <tr>
                                    <th style="width: 20%">基本信息</th>
                                    <th style="width: 80%">内容</th>
                                </tr>
                                </tbody>
                                <tbody>
                                
                                <tr>
                                    <td>检测项名称</td>
                                    <td class="input-group">
                                        <input type="text" class="form-control" id="check_item_name_EN" value="">
                                    </td>
                                </tr>
                                <tr>
                                    <td>中文说明</td>
                                    <td>
                                        <textarea id="check_item_name_CN"  style="width:649px;height:60px;"></textarea>    
                                    </td>
                                </tr>
                                <tr>
                                    <td>查询方法</td>
                                    <td>
                                        <textarea id="query_method" style="width:649px;height:200px;"></textarea>
                                    </td>
                                </tr>
                                <tr>
                                    <td>验证方法</td>
                                    <td>
                                        <textarea id="proving_method" style="width:649px;height:200px;"></textarea>
                                    </td>
                                </tr>

                                <tr>
                                    <td>健康值</td>
                                    <td class="input-group">
                                        <input type="text" class="form-control" id="health_num" value="">
                                    </td>
                                </tr>
                                <tr>
                                    <td>分类</td>
                                    <td class="input-group">
                                        <input type="text" class="form-control" id="classify" value="">
                                    </td>
                                </tr>

                                <tr>
                                    <td>故障解决方案</td>
                                    <td>           
                                        <textarea id="resolve_info"  style="width:649px;height:100px;"></textarea>
                                    </td>
                                </tr>
                                </tbody>
                            </table>

                            </div>
                            <div class="modal-footer">      
                                <button type="button" class="btn btn-default" data-dismiss="modal" onclick="add_check_item_info()">提交检测信息</button>      
                            </div>
                        </div>
                    </div>
                </div>            
<br>
<br>
<br>
                        <table id="check_item"  class="table table-striped table-bordered" cellspacing="0" cellpadding="0" width="100%" >
                            <thead>                         
                            <tr>                            
                                <th style="text-align:center;white-space:nowrap;">序号</th>
                                <th style="text-align:center;white-space:nowrap;">检测项名称</th>   
                                <th style="text-align:center;white-space:nowrap;">中文说明 </th>   
                                <th style="text-align:center;white-space:nowrap;display:none">查询方法</th>
                                <th style="text-align:center;white-space:nowrap;display:none">验证方法</th>
                                <th style="text-align:center;white-space:nowrap;">健康值</th>
                                <th style="text-align:center;white-space:nowrap;">分类</th>
                                <th style="text-align:center;white-space:nowrap;display:none">故障解决方案</th>
                                <th style="text-align:center;white-space:nowrap;">查看</th>
                                <th style="text-align:center;white-space:nowrap;">编辑</th>            
                            </tr>                           
                            </thead>                                                                  
                            <tbody>                         
                                {% for info in update_check_item_set %}
                                <tr>                            
                                    <td style="text-align:center;width:2%;" >{{ info.id  }}</td>
                                    <td style="text-align:center;width:7%;">{{ info.check_item_name_EN }}</td>
                                    <td style="text-align:left;width:10%;word-break:break-all;">{{ info.check_item_name_CN }}</td> 
                                    <td style="text-align:left;width:15%;white-space:nowrap;display:none"> <div style="margin:0px;overflow-x:scroll;width:200px;overflow-y:scroll;height:300px;"> {% if info.query_method  %} {{ info.query_method | add_newline_br |safe }} {% else  %} <div style="text-align:center;height:100%;line-height: 300px;">无</div> {% endif  %} </div> </td>
                                    <td style="text-align:left;width:15%;white-space:nowrap;display:none"> <div style="overflow-x:scroll;width:200px;overflow-y:scroll;height:300px;">  {% if info.proving_method  %} {{ info.proving_method | add_newline_br |safe  }}  {% else  %} <div style="text-align:center;height:100%;line-height:300px"> 无 </div> {% endif  %} </div> </td>
                                    <td style="text-align:center;width:1%;"> {{ info.health_num }}  </td>
                                    <td style="text-align:center;width:4%;">{% if info.classify  %} {{ info.classify }} {% endif  %} </td>
                                    <td style="text-align:left;width:18%;word-break:break-all;display:none">{{ info.resolve_info | add_newline_br |safe }}</td>
                                    <td id="see" style="text-align:center;width:9%;">
                                        <a id="view_query_method" flag={{ info.query_method | add_newline_br }}> 查询方法 </a>
                                        <a id="view_proving_method" flag={{ info.proving_method | add_newline_br  }}> 检验方法 </a>
                                        <a id="view_resolve_info" flag={{ info.resolve_info | add_newline_br  }}> 解决方案  </a></td>
                                    <td style="text-align:center;width:2%;"><button class="btn btn-warning" data-toggle="modal" data-target="#modal{{ info.id }}">编辑</button></td>

<div class="modal fade" id="modal{{ info.id }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="width: 802px;">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    编辑检测项
                </h4>
            </div>
            <div class="modal-body">
                    <h4>检测项名称</h4>
                        <input type="text" class="form-control" id="item_id{{info.id}}_name" style="width: 332px;"  value="{{ info.check_item_name_EN }}">
                    <h4>中文说明</h4>
                        <textarea id="item_id{{info.id}}_instructions" style="width: 753px;height: 40px;">{{ info.check_item_name_CN }}</textarea>
                    <h4>查询方法</h4>
                        <textarea id="item_id{{info.id}}_query" style="width: 753px;height: 200px;">{{ info.query_method }}</textarea>
                    <h4>验证方法</h4>
                        <textarea id="item_id{{info.id}}_proving" style="width: 753px;height: 200px;">{{ info.proving_method }}</textarea>
                    <h4>健康值</h4>
                     <input type="text" class="form-control" id="item_id{{info.id}}_health" style="width: 332px;"  value="{{ info.health_num }}">
                    <h4>分类</h4>
                     <input type="text" class="form-control" id="item_id{{info.id}}_classify" style="width: 332px;"  value="{{ info.classify }}">

                    <h4>故障解决方案</h4>
                        <textarea id="item_id{{info.id}}_resolve" style="width: 753px;height: 60px;">{{ info.resolve_info  }}</textarea>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="modify_item_info('{{ info.id }}')">提交更改</button>
            </div>
        </div>
    </div>
</div> 
                                </tr>                           
                                {% endfor %}
                            </tbody>                        
                        </table>     

                  </div>
                </div>
              </div>
            </div>

            <div class="am-u-md-41" id="down_loading" style="text-align:center;margin-top: 211px;display:none"  align="center">
                <img src="/static/images/boy_loading.gif"  style="text-align:center" alt="system_process-img" class="img-rounded"> 
                <h3>   玩命下载中，请稍等。。。。。。</h3>
            </div>

            {% endblock %}

        {% block extrajs %}
		<script type="text/javascript">
            $(document).ready(function() {
                $('#check_item').DataTable( {
                });
            });
            
       $("a[id^='view']").click(function() {
                var html = $(this).attr('flag');
                var title = $(this).text();
                var text = '';
                text += "<table  class='display_' cellspacing='0' cellpadding='0' width='100%' > ";
                text += "<thead>  <tr>";                            
                text += "<th style='text-align:center;white-space:nowrap;'>" + title + "</th>";
                text += "</tr> </thead> <tbody> <tr>";
                temp = "<td style='text-align:center;width:100%;'>";
                if ( $(this).attr('id') == 'view_proving_method' || $(this).attr('id') == 'view_query_method' || $(this).attr('id') == 'view_resolve_info' ) {
                   temp = "<td style='text-align:left;width:100%;white-space:nowrap;'>";  
                   if ( !html  ) {
                      temp += "<div style='text-align:center;height:100%;line-height: 300px;'>无</div>";
                   }
                }
                text += temp;
                text += html;
                text += "</td>";
                text += " </tr>  ";
                text += "</tbody>  </table>";
                   layer.open({
                          title:'检测项信息',
                          type:1,
                          time:600000,
                          area: ['560px', '480px'],
                         content: text,
                  });
            });

            function add_check_item_info(){
                var check_item_name_EN = $("#check_item_name_EN").val()
                var check_item_name_CN = $("#check_item_name_CN").val()
                var resolve_info = $("#resolve_info").val()
                var query_method = $("#query_method").val()
                var proving_method = $("#proving_method").val()
                var health_num = $("#health_num").val()
                var classify = $("#classify").val()
                if (!check_item_name_EN){
                    alert("请输入检测项名称")
                    return false
                } else if (!check_item_name_CN){
                    alert("请输入检测项中文说明")
                    return false
                } else if (check_item_name_CN.length > 80 ){
                    alert("根据数据库定义，中文说明过长，不能超过80")
                    return false
                } else if (!resolve_info){
                    alert("请输入故障解决方案")
                    return false
                } else if (!health_num){
                    alert("健康值不能为空")
                    return false
                } else if (isNaN(health_num)){
                   alert("健康值格式为非法数字，请更正，谢谢！")
                   return false
                } else if (!classify){
                    alert("请输入类别")
                    return false
                } else{
                $.ajax({
                       url:'{% url "aliyun:update_check_item"  %}',
                       type:'POST',
                       async:true,
                       data:{
                                check_item_name_EN:check_item_name_EN,
                                check_item_name_CN:check_item_name_CN,
                                resolve_info:resolve_info,
                                query_method:query_method,
                                proving_method:proving_method,
                                health_num:health_num,
                                classify:classify,
                                add:1
                            },
                       timeout:5000,
                       dataType:'json',
                       success:function(res)
                       {
                       if(res["msg"]=="ok"){location.reload()}
                       },
                });
                }
            }

            function modify_item_info(item_id){
                var item_id_name = "#item_id"+item_id+"_name" 
                var item_id_instructions = "#item_id"+item_id+"_instructions"
                var item_id_query = "#item_id"+item_id+"_query"
                var item_id_proving = "#item_id"+item_id+"_proving"               
                var item_id_health = "#item_id"+item_id+"_health"
                var item_id_classify = "#item_id"+item_id+"_classify"
                var item_id_resolve = "#item_id"+item_id+"_resolve"
                var check_item_name_EN = $(item_id_name).val()
                var check_item_name_CN = $(item_id_instructions).val()
                var resolve_info = $(item_id_resolve).val()
                var query_method = $(item_id_query).val()
                var proving_method = $(item_id_proving).val()
                var health_num = $(item_id_health).val()
                var classify = $(item_id_classify).val()
                
                if (!check_item_name_EN){
                    alert("检测项名称不能为空")
                    return false
                } else if (!check_item_name_CN){
                    alert("请输入检测项中文说明")
                    return false
                } else if (check_item_name_CN.length > 80 ){
                    alert("根据数据库定义，中文说明过长，不能超过80")
                    return false
                } else if (!resolve_info){
                    alert("请输入故障解决方案")
                    return false
                } else if (!health_num){
                    alert("健康值不能为空")
                    return false
                } else if (isNaN(health_num)){
                   alert("健康值格式为非法数字，请更正，谢谢！")
                   return false
                } else if (!classify){
                    alert("请输入类别")
                    return false
                } else { 
                $.ajax({
                       url:'{% url "aliyun:update_check_item"  %}',
                       type:'POST',
                       async:true,
                       data:{item_id:item_id,check_item_name_EN:check_item_name_EN,check_item_name_CN:check_item_name_CN,resolve_info:resolve_info,query_method:query_method,proving_method:proving_method,health_num:health_num,classify:classify,modify:1},
                       timeout:5000,
                       dataType:'json',
                       success:function(res)
                       {
                       if(res["msg"]=="ok"){location.reload()}
                       },
                });
            }
          }
       
        </script>
	
        {% endblock %}	

