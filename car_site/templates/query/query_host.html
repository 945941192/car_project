		
    {% extends 'base2/base.html' %}
    {% block title %}上传主机check日志{% endblock %}
        {% block content %}

        <div class="page-title">
              <div class="" style="width: 100%;float: left;display: block;">
              </div>
        </div>

        <div class="clearfix"></div>

        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                    <div class="x_title">
                        <h2> Query <small> 可选参数查询专有云内符合条件的主机信息 </small></h2>
                        <ul class="nav navbar-right panel_toolbox">
                            <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                                <ul class="dropdown-menu" role="menu">
                                </ul>
                            </li>
                            <li><a class="close-link"><i class="fa fa-close"></i></a>
                            </li>
                        </ul>
                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content" style="padding-left: 100px;">
                        <p class="text-muted font-13 m-b-30"></p>


    <form id="query_host" enctype="multipart/form-data" action="{% url 'query:query_host' %}"  method="get">

        <h4 style="display: inline-block;"><font size=3 >云类别&nbsp;:&nbsp;&nbsp;&nbsp;</font></h4>
        <select class="form-control" id="cloud_id" name="cloud_type"  style="width:15%;display:inline-block" disabled="disabled">
                <option value="#">专有云</option>
        </select>

        <h2 style="display: inline-block">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h2>

        <h4 style="display: inline-block;"><font size=3 >版本&nbsp;:&nbsp;&nbsp;&nbsp;</font></h4>
        <select class="form-control" id="cloud_version_id" name="cloud_version_id"  style="width:15%;display:inline-block">
            <option value="a">All ...</option>
            {% for obj in version_set  %}
                <option value="{{ obj.version_id }}">{{ obj.version_type }}</option>
            {% endfor  %}
        </select>

        <h2 style="display: inline-block">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h2>

        <h4 style="display: inline-block;"><font size=3 >项目名称&nbsp;:&nbsp;&nbsp;</font></h4>
        <input type="text" id="project_backups" name="project_backups" value="{{ project_id }}" style="display:none" />
        <select class="project_list" id="project_id"  name="project_id" class="form-control" style="width: 20%" data-placeholder="{{ project_name }}"></select>

<br>
<br>

        <h4 style="display: inline-block;"><font size=3 >检测项&nbsp;:&nbsp;&nbsp;&nbsp;</font></h4>
        <select class="form-control" id="check_item_id" name="check_item_id"  style="width:15%;display:inline-block">
            <option value="a">All ...</option>
            {% for obj in check_item_set  %}
                <option value="{{ obj.id }}">{{ obj.check_item_name_CN }}</option>
            {% endfor  %}
        </select>

        <h2 style="display: inline-block">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h2>

        <h4 style="display: inline-block;"><font size=3 >日期&nbsp;:&nbsp;&nbsp;&nbsp;</font></h4>
        <input type="text" class="form-control" id="date_range" name="date_range" style="width:20%;display:inline-block;">

        <h2 style="display: inline-block">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h2>

        <button  type="button" style="display:inline-block"  class="btn btn-warning"  onclick="query_host()">Query</button>      

        <h2 style="display: inline-block">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</h2>

        <button type="button" class="btn btn-info" onclick="reset_query_option()">重置</button>

</form>

                  </div>
                </div>
              </div>
            </div>



        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
                <div class="x_panel">
                    <div class="x_title">
                        <h2> Show <small> 展示符合条件的主机信息（可查询、排序） </small></h2>
                        <ul class="nav navbar-right panel_toolbox">
                            <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-wrench"></i></a>
                                <ul class="dropdown-menu" role="menu">
                                </ul>
                            </li>
                            <li><a class="close-link"><i class="fa fa-close"></i></a>
                            </li>
                        </ul>
                        <div class="clearfix"></div>
                    </div>
                    <div class="x_content">
                        <p class="text-muted font-13 m-b-30"></p>


                        <table id="example" class="table table-striped table-bordered">
                            <thead>                         
                            <tr>                            
                                <th  style="text-align:center; width:10%">序号</th>                
                                <th  style="text-align:center; width:40%">主机名称</th>                
                                <th  style="text-align:center; width:20%">最新监测日期</th>               
                                <th  style="text-align:center; width:30%">健康值  </th>            
                            </tr>                           
                            </thead>                                                                  
                        </table>     


                  </div>
                </div>
              </div>
            </div>

            {% endblock %}


		



        {% block extrajs %}
		<script type="text/javascript">
            //submit form data
            function query_host(){
                $("#query_host").submit()
            };

            function reset_query_option(){
                var url = "{% url 'query:query_host' %}"
                location.href = url;
            }

            //select2 异步请求获取项目列表
            function select2_fun(cloud_version_id){
                $(".project_list").select2({
                    ajax: {
                        url: "{% url 'aliyun:project_list' %}?&cloud_version_id="+cloud_version_id,
                        cache: true,
                    }
                });

            }
        
            $('#date_range').daterangepicker({
            // singleDatePicker: true,
                startDate: moment().subtract(6, 'days'),
                "locale":{
                    format: 'YYYY-MM-DD',
                    applyLabel: '应用',
                    cancelLabel: '取消',
                    resetLabel: '重置',
                },
            });



            $(document).ready(function() {

                $("#cloud_version_id").change(function(){
                    var cloud_type_id = $("#cloud_type_id").val()
                    var cloud_version_id = $("#cloud_version_id").val()
                    var url = "{% url 'aliyun:upload_host_check_log' %}?cloud_type_id="+cloud_type_id+'&cloud_version_id='+cloud_version_id
                    //清空 项目下拉菜单
                    $("#project_id").val('')
                    select2_fun(cloud_version_id)
                });

            });
           


            $(document).ready(function() {

// 渲染二次参数
    //初始化云类型版本类型为专有云
                // version_id
                $("#cloud_version_id").val('{{ version_id | safe }}')
                // project_id
//                $("#project_id").val("hllooe") 由于select2 插件导致无法写入val() 或者 更改属性也失败  直接用模板判断渲染
                // check_item_id
                $("#check_item_id").val('{{ check_item_id | safe }}')
                // date_range
                $('#date_range').val("{{ date_range | safe }}")

                // 当版本不为all时，可以选择对应项目                      
                var cloud_version_id = $("#cloud_version_id").val()
                $(".project_list").select2({
                    ajax:{
                        url:"{% url 'aliyun:project_list' %}?cloud_version_id="+cloud_version_id
                    }
                })

            //datatable ajax post 主要是分页和页面展示数量、搜索功能
                var version_id = $("#cloud_version_id").val()
//                var project_id = $("#project_id").val()  //只有手动选择项目的情况才不为null
                var project_backups = $("#project_backups").val() //这个是渲染过来的，query 按钮点击后 这个就会被填充 
                var check_item_id = $("#check_item_id").val()
                var date_range = $("#date_range").val()

                $('#example').DataTable( {
                    "columnDefs": [
                        { "orderable": false, "targets": 0  },
                        { "orderable": false, "targets": 1  }
                    ],
                    "order": [[ 3, 'desc'  ],],
//                    "searching": false,
//                    "processing":true,
                    "serverSide":true,
                    "oLanguage": {
                        "sLengthMenu": "每页显示 _MENU_ 条记录",
                        "sZeroRecords": "抱歉， 没有找到",
                        "sInfo": "从 _START_ 到 _END_ /共 _TOTAL_ 条数据",
                        "sInfoEmpty": "没有数据",
                        "sInfoFiltered": "(从 _TOTAL_ 条数据中检索)",
                        "oPaginate": {
                            "sFirst": "首页",
                            "sPrevious": "前一页",
                            "sNext": "后一页",
                            "sLast": "尾页"
                        },
                        "sZeroRecords": "没有检索到数据"
                    }, 
//                    "columnDefs": [
//                        { "width": "10%" },
//                        { "width": "30%" },
//                        { "width": "40%" },
//                    ],
                    "createdRow": function( row, data, dataIndex ) {
                        $(row).children('td').eq(0).attr('style', 'text-align: center;vertical-align: middle;')
                        $(row).children('td').eq(1).attr('style', 'text-align: center;vertical-align: middle;')
                        $(row).children('td').eq(2).attr('style', 'text-align: center;vertical-align: middle;')
                        $(row).children('td').eq(3).attr('style', 'text-align: center;vertical-align: middle;')
                    },
                    "ajax":{
                        "url":"{% url 'query:query_host' %}?version_id="+ version_id + "&project_id=" + project_backups + "&check_item_id=" + check_item_id + "&date_range=" + date_range,
                        "type":"POST",
                    //    "data": {
                    //            "user_id": 451
                    //    },
                    },
                    "columns":[
                        {"data":"num"},
                        {"data":"host_name"},
                        {"data":"newest_check_date"},
                        {"data":"newest_health_num"}
                    ],

                });


        

            });
        </script>
	
        {% endblock %}	

